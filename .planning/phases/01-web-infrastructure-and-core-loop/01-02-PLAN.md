---
phase: 01-web-infrastructure-and-core-loop
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - static/index.html
  - static/app.js
  - static/styles.css
autonomous: true

must_haves:
  truths:
    - "Opening index.html in browser shows GridWorld grid canvas"
    - "Grid renders with obstacles, goal, and agent position"
    - "Parameter controls are visible in right sidebar"
    - "Clicking parameter presets updates input values"
    - "Parameter values persist after page refresh"
  artifacts:
    - path: "static/index.html"
      provides: "Main page with canvas, controls sidebar, and UI layout"
      min_lines: 80
    - path: "static/app.js"
      provides: "GridRenderer class and parameter management logic"
      min_lines: 150
    - path: "static/styles.css"
      provides: "Clean minimal styling for grid and controls"
      min_lines: 80
  key_links:
    - from: "static/app.js GridRenderer.render()"
      to: "HTML canvas element"
      via: "2D context drawing operations"
      pattern: "ctx\\.(fillRect|arc|stroke)"
    - from: "static/app.js parameter inputs"
      to: "localStorage"
      via: "save/load on change/load events"
      pattern: "localStorage\\.(getItem|setItem)"
---

<objective>
Build frontend grid visualization and training controls interface using vanilla JavaScript and Canvas API.

Purpose: Create the user-facing interface components that will display training progress and accept parameter inputs. This work is independent of backend and can proceed in parallel.

Output: Complete static frontend with grid visualization, parameter controls, and UI state persistence.
</objective>

<execution_context>
@/Users/luckleineschaars/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luckleineschaars/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-web-infrastructure-and-core-loop/01-CONTEXT.md
@.planning/phases/01-web-infrastructure-and-core-loop/01-RESEARCH.md
@src/gridworld/config.py
</context>

<tasks>

<task type="auto">
  <name>Create Canvas-based grid renderer with animation loop</name>
  <files>static/index.html, static/app.js, static/styles.css</files>
  <action>
    Create static/ directory and frontend files following RESEARCH.md Pattern 4 (Canvas Grid Visualization).

    **static/index.html:**
    - Basic HTML5 structure with viewport meta tag
    - Main container with two-column layout (grid left, controls right)
    - Canvas element with id="grid-canvas" for GridWorld visualization
    - Status display area showing episode/step counters (initially hidden/zero)
    - Link to styles.css and defer-load app.js

    **static/app.js - GridRenderer class:**
    - Constructor accepts canvasId, gridSize, cellSize (default 50px for 5x5 grid)
    - Set canvas width/height based on gridSize * cellSize
    - Initialize state object: { agent_pos, goal_pos, obstacles, trail }
    - Implement update(newState) method that updates internal state and trail array (max 20 positions per RESEARCH.md pitfall 3)
    - Implement render() method:
      * Clear canvas with background color (#f5f5f5 - light gray)
      * Draw grid lines (thin, light color #ddd)
      * Draw obstacles as dark filled squares (#333)
      * Draw trail with fading opacity effect (most recent brightest)
      * Draw goal as green circle (#4caf50)
      * Draw agent as red/orange circle (#ff6b6b)
    - Implement startAnimationLoop() using requestAnimationFrame (60fps)
    - Export GridRenderer class

    Follow CONTEXT.md visual aesthetic: clean, minimal, simple colors, thin borders, flat design.

    **static/styles.css:**
    - CSS reset/normalize basics (*, box-sizing)
    - Body: sans-serif font (system fonts), centered layout
    - Two-column grid layout: main canvas area (flex-grow), sidebar fixed width (300px)
    - Canvas: border, box-shadow for subtle elevation
    - Clean minimal styling - no heavy gradients or shadows
    - Responsive basics (single column on narrow screens if time permits, otherwise desktop-only is fine)

    Reference RESEARCH.md Canvas Grid Renderer code example for render implementation details.
  </action>
  <verify>
    1. Create test file static/test.html that initializes GridRenderer with mock data
    2. Open static/test.html in browser
    3. Confirm grid renders with obstacles, goal, agent
    4. Manually call renderer.update({agent_pos: [2,2]}) in console, verify agent moves
    5. Check trail appears and fades (max 20 positions)
    6. Verify animation loop runs at 60fps (Chrome DevTools Performance tab)
  </verify>
  <done>
    - Canvas renders 5x5 grid with clear cell boundaries
    - Obstacles render as dark squares in configured positions
    - Goal renders as green circle
    - Agent renders as red circle at current position
    - Trail effect shows recent agent positions with fading opacity
    - Animation loop maintains 60fps without memory leaks
  </done>
</task>

<task type="auto">
  <name>Build parameter controls with presets and persistence</name>
  <files>static/index.html, static/app.js, static/styles.css</files>
  <action>
    Add training controls UI to the static files following CONTEXT.md decisions.

    **static/index.html additions (in sidebar):**
    - Action buttons at top: Start Training, Stop Training, Reset (prominent, always visible)
    - Parameter section with three inputs (each with label, slider, and number input):
      * Learning Rate (alpha): range 0.01-1.0, step 0.01, default 0.1
      * Epsilon (exploration): range 0.0-1.0, step 0.05, default 1.0
      * Discount Factor (gamma): range 0.0-1.0, step 0.05, default 0.99
    - Preset buttons: Conservative, Balanced, Aggressive (quick parameter sets)
    - Visual feedback section: Episode counter, Step counter (updated from WebSocket later)

    **static/app.js additions:**
    - Parameter management module:
      * loadParams() - read from localStorage or use defaults
      * saveParams() - write to localStorage on input change
      * applyPreset(presetName) - apply preset values to inputs
    - Preset definitions:
      * Conservative: {learning_rate: 0.05, epsilon: 1.0, discount_factor: 0.99}
      * Balanced: {learning_rate: 0.1, epsilon: 1.0, discount_factor: 0.95}
      * Aggressive: {learning_rate: 0.3, epsilon: 0.8, discount_factor: 0.9}
    - Input event handlers:
      * Sync slider ↔ number input (both update each other)
      * Save to localStorage on change
      * Lock inputs during training (disabled attribute - implemented in Plan 03)
    - Button state management:
      * Start button enables when training stopped
      * Stop button enables when training running
      * Reset always enabled

    **static/styles.css additions:**
    - Sidebar styling: padding, background color (slight gray tint)
    - Button styling: clear CTAs, disabled states, hover effects
    - Input group layout: label above, slider and number input side-by-side
    - Preset buttons: secondary style, grid layout (3 buttons in a row)
    - Status counters: monospace font, larger text

    Follow CONTEXT.md decisions: parameters locked during training (disable inputs), sliders + inputs for precision, presets for quick experimentation.
  </action>
  <verify>
    1. Open static/index.html in browser
    2. Adjust learning rate slider, verify number input updates
    3. Type in epsilon number input, verify slider updates
    4. Click "Balanced" preset, verify all three params update to balanced values
    5. Refresh page, verify parameters persist (loaded from localStorage)
    6. Clear localStorage, verify defaults load correctly
  </verify>
  <done>
    - All three parameter inputs (learning_rate, epsilon, discount_factor) present with sliders and number inputs
    - Slider and number input stay synchronized
    - Three preset buttons apply correct parameter sets
    - Parameters save to localStorage on change
    - Parameters load from localStorage on page load
    - Start/Stop/Reset buttons present and styled
    - Episode and step counters present (initially showing 0)
  </done>
</task>

</tasks>

<verification>
**Frontend grid visualization:**
1. Canvas renders correctly with 5x5 grid
2. Static test data (agent, goal, obstacles) renders correctly
3. Animation loop runs without performance issues
4. Trail effect appears and fades correctly
5. No console errors in browser DevTools

**Frontend controls:**
1. All parameter inputs present and functional
2. Slider ↔ number input synchronization works
3. Presets apply correct values
4. localStorage persistence works across refreshes
5. UI matches clean minimal aesthetic from CONTEXT.md
</verification>

<success_criteria>
Plan succeeds when:
1. GridRenderer displays 5x5 canvas with agent, goal, obstacles, trail
2. Animation loop maintains 60fps
3. Parameter controls accept and display values correctly
4. Presets apply expected parameter combinations
5. Parameter values persist across page refreshes via localStorage
6. Frontend is ready for WebSocket integration (Plan 03)
7. No external JavaScript libraries required (vanilla JS only)
</success_criteria>

<output>
After completion, create `.planning/phases/01-web-infrastructure-and-core-loop/01-02-SUMMARY.md`
</output>
